<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Native Ecosystem Maintenance Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <style>
        .sidebar {
            min-height: 100vh;
            background-color: #2c3e50;
            color: white;
        }
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: #34495e;
        }
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        .main-content {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .card {
            margin-bottom: 20px;
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .map-container {
            height: 400px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        #map { 
            height: 100%;
            width: 100%;
            border-radius: 5px;
        }
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .leaflet-top.leaflet-right {
            margin-top: 50px;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
        }
        .form-control.is-invalid {
            background-image: none;
            padding-right: 0.75rem;
        }
        .form-control.is-valid {
            background-image: none;
            padding-right: 0.75rem;
        }
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .image-thumbnail {
            max-width: 100px;
            max-height: 100px;
            object-fit: cover;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .species-image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="toast-container">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message">
                Operation completed successfully.
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-0">
                <div class="logo">EcoMaintain</div>
                <ul class="nav flex-column p-3">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">
                            <i class="bi bi-speedometer2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#site-assessment" data-bs-toggle="tab">
                            <i class="bi bi-clipboard-data"></i> Site Assessment
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#maintenance-plan" data-bs-toggle="tab">
                            <i class="bi bi-calendar-check"></i> Maintenance Plan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#species-register" data-bs-toggle="tab">
                            <i class="bi bi-tree"></i> Species Register
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#monitoring" data-bs-toggle="tab">
                            <i class="bi bi-binoculars"></i> Monitoring
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#reports" data-bs-toggle="tab">
                            <i class="bi bi-file-earmark-text"></i> Reports
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 ms-sm-auto main-content">
                <div class="tab-content">
                    <!-- Dashboard Tab -->
                    <div class="tab-pane fade show active" id="dashboard">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Native Ecosystem Maintenance Dashboard</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newActivityModal">
                                    <i class="bi bi-plus"></i> New Activity
                                </button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Upcoming Tasks</h5>
                                        <div class="list-group" id="upcomingTasksList">
                                            <!-- Tasks will be loaded here dynamically -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Site Health Status</h5>
                                        <div id="healthIndicators">
                                            <!-- Indicators will be loaded here dynamically -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Recent Observations</h5>
                                        <ul class="list-group list-group-flush" id="recentObservationsList">
                                            <!-- Observations will be loaded here dynamically -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Site Map</h5>
                                        <div class="map-container p-3">
                                            <div id="map"></div>
                                            <div class="map-controls">
                                                <div class="btn-group-vertical">
                                                    <button id="zoneToggle" class="btn btn-sm btn-outline-primary active">Zones</button>
                                                    <button id="vegetationToggle" class="btn btn-sm btn-outline-success">Vegetation</button>
                                                    <button id="weedsToggle" class="btn btn-sm btn-outline-danger">Weeds</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Compliance Checklist</h5>
                                        <div id="complianceChecklist">
                                            <!-- Checklist will be loaded here dynamically -->
                                        </div>
                                        <div class="progress mt-3">
                                            <div class="progress-bar bg-success" id="complianceProgress" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0% Complete</div>
                                        </div>
                                        <button class="btn btn-sm btn-primary mt-3" id="generateComplianceReport">Generate Compliance Report</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Site Assessment Tab -->
                    <div class="tab-pane fade" id="site-assessment">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Site Assessment</h1>
                            <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newAssessmentModal">
                                <i class="bi bi-plus"></i> New Assessment
                            </button>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">New Site Assessment</h5>
                                <form id="assessmentForm">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <label for="assessmentDate" class="form-label">Assessment Date *</label>
                                            <input type="date" class="form-control" id="assessmentDate" required>
                                            <div class="invalid-feedback">Please provide a valid date.</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="assessorName" class="form-label">Assessor Name *</label>
                                            <input type="text" class="form-control" id="assessorName" required>
                                            <div class="invalid-feedback">Please provide the assessor's name.</div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="siteDescription" class="form-label">Site Description *</label>
                                        <textarea class="form-control" id="siteDescription" rows="3" required></textarea>
                                        <div class="invalid-feedback">Please provide a site description.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Ecosystem Components Present *</label>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="flora" name="components" value="flora">
                                                    <label class="form-check-label" for="flora">Flora</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="fauna" name="components" value="fauna">
                                                    <label class="form-check-label" for="fauna">Fauna</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="soil" name="components" value="soil">
                                                    <label class="form-check-label" for="soil">Soil</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="water" name="components" value="water">
                                                    <label class="form-check-label" for="water">Water</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="geology" name="components" value="geology">
                                                    <label class="form-check-label" for="geology">Geology</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="climate" name="components" value="climate">
                                                    <label class="form-check-label" for="climate">Climate</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="invalid-feedback" id="componentsFeedback">Please select at least one component.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="ecosystemHealth" class="form-label">Ecosystem Health Assessment *</label>
                                        <select class="form-select" id="ecosystemHealth" required>
                                            <option value="" selected disabled>Select health rating...</option>
                                            <option value="excellent">Excellent - Minimal disturbance</option>
                                            <option value="good">Good - Some disturbance but recovering</option>
                                            <option value="fair">Fair - Moderate disturbance</option>
                                            <option value="poor">Poor - Significant disturbance</option>
                                            <option value="degraded">Degraded - Severe disturbance</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a health rating.</div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="threats" class="form-label">Identified Threats</label>
                                        <select class="form-select" id="threats" multiple>
                                            <option value="weeds">Weeds</option>
                                            <option value="pests">Pests</option>
                                            <option value="erosion">Erosion</option>
                                            <option value="fire">Fire</option>
                                            <option value="climate">Climate change</option>
                                            <option value="development">Development</option>
                                            <option value="recreation">Recreational impacts</option>
                                            <option value="grazing">Grazing</option>
                                        </select>
                                    </div>

                                    <div class="mb-3">
                                        <label for="assessmentPhotos" class="form-label">Upload Photos</label>
                                        <input class="form-control" type="file" id="assessmentPhotos" multiple accept="image/*">
                                        <div class="image-preview-container" id="assessmentPhotoPreview"></div>
                                    </div>

                                    <button type="submit" class="btn btn-primary">Save Assessment</button>
                                </form>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Previous Assessments</h5>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="assessmentsTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Assessor</th>
                                                <th>Health Rating</th>
                                                <th>Main Threats</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Assessments will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Maintenance Plan Tab -->
                    <div class="tab-pane fade" id="maintenance-plan">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Maintenance Plan</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newActivityModal">
                                    <i class="bi bi-plus"></i> New Activity
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Maintenance Activities</h5>
                                <ul class="nav nav-tabs" id="maintenanceTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button" role="tab">Upcoming</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab">Completed</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="overdue-tab" data-bs-toggle="tab" data-bs-target="#overdue" type="button" role="tab">Overdue</button>
                                    </li>
                                </ul>
                                <div class="tab-content p-3 border border-top-0 rounded-bottom">
                                    <div class="tab-pane fade show active" id="upcoming" role="tabpanel">
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="upcomingActivitiesTable">
                                                <thead>
                                                    <tr>
                                                        <th>Activity</th>
                                                        <th>Type</th>
                                                        <th>Scheduled</th>
                                                        <th>Location</th>
                                                        <th>Assigned To</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Upcoming activities will be loaded here dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="completed" role="tabpanel">
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="completedActivitiesTable">
                                                <thead>
                                                    <tr>
                                                        <th>Activity</th>
                                                        <th>Type</th>
                                                        <th>Completed</th>
                                                        <th>Location</th>
                                                        <th>Assigned To</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Completed activities will be loaded here dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="overdue" role="tabpanel">
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="overdueActivitiesTable">
                                                <thead>
                                                    <tr>
                                                        <th>Activity</th>
                                                        <th>Type</th>
                                                        <th>Due Date</th>
                                                        <th>Location</th>
                                                        <th>Assigned To</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Overdue activities will be loaded here dynamically -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Species Register Tab -->
                    <div class="tab-pane fade" id="species-register">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Species Register</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newSpeciesModal">
                                    <i class="bi bi-plus"></i> New Species
                                </button>
                            </div>
                        </div>

                        <div class="row" id="speciesCardsContainer">
                            <!-- Species cards will be loaded here dynamically -->
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Species List</h5>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="speciesTable">
                                        <thead>
                                            <tr>
                                                <th>Scientific Name</th>
                                                <th>Common Name</th>
                                                <th>Type</th>
                                                <th>Status</th>
                                                <th>Last Observed</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Species will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monitoring Tab -->
                    <div class="tab-pane fade" id="monitoring">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Monitoring</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#newMonitoringModal">
                                    <i class="bi bi-plus"></i> New Monitoring
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Recent Monitoring Activities</h5>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="monitoringTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Type</th>
                                                <th>Location</th>
                                                <th>Observer</th>
                                                <th>Findings</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Monitoring activities will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Reports Tab -->
                    <div class="tab-pane fade" id="reports">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Reports</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#generateReportModal">
                                    <i class="bi bi-file-earmark-plus"></i> Generate Report
                                </button>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Previous Reports</h5>
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover" id="reportsTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Report Type</th>
                                                <th>Generated By</th>
                                                <th>Period</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- Reports will be loaded here dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- New Activity Modal -->
    <div class="modal fade" id="newActivityModal" tabindex="-1" aria-labelledby="newActivityModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newActivityModalLabel">New Maintenance Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="activityForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="activityType" class="form-label">Activity Type *</label>
                                <select class="form-select" id="activityType" required>
                                    <option value="" selected disabled>Select type...</option>
                                    <option value="weed-control">Weed Control</option>
                                    <option value="revegetation">Revegetation</option>
                                    <option value="erosion-control">Erosion Control</option>
                                    <option value="fauna-survey">Fauna Survey</option>
                                    <option value="vegetation-survey">Vegetation Survey</option>
                                    <option value="water-quality">Water Quality Testing</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="invalid-feedback">Please select an activity type.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="activityTitle" class="form-label">Title *</label>
                                <input type="text" class="form-control" id="activityTitle" required>
                                <div class="invalid-feedback">Please provide a title.</div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="activityStartDate" class="form-label">Start Date *</label>
                                <input type="datetime-local" class="form-control" id="activityStartDate" required>
                                <div class="invalid-feedback">Please provide a start date.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="activityEndDate" class="form-label">End Date</label>
                                <input type="datetime-local" class="form-control" id="activityEndDate">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="activityLocation" class="form-label">Location *</label>
                            <input type="text" class="form-control" id="activityLocation" required>
                            <div class="invalid-feedback">Please provide a location.</div>
                        </div>

                        <div class="mb-3">
                            <label for="activityDescription" class="form-label">Description *</label>
                            <textarea class="form-control" id="activityDescription" rows="3" required></textarea>
                            <div class="invalid-feedback">Please provide a description.</div>
                        </div>

                        <div class="mb-3">
                            <label for="activityAssignedTo" class="form-label">Assigned To *</label>
                            <input type="text" class="form-control" id="activityAssignedTo" required>
                            <div class="invalid-feedback">Please specify who this is assigned to.</div>
                        </div>

                        <div class="mb-3">
                            <label for="activityPriority" class="form-label">Priority</label>
                            <select class="form-select" id="activityPriority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="activityStatus" class="form-label">Status</label>
                            <select class="form-select" id="activityStatus">
                                <option value="planned">Planned</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="cancelled">Cancelled</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="activityNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="activityNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveActivity">Save Activity</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Species Modal -->
    <div class="modal fade" id="newSpeciesModal" tabindex="-1" aria-labelledby="newSpeciesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newSpeciesModalLabel">New Species Record</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="speciesForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="speciesScientificName" class="form-label">Scientific Name *</label>
                                <input type="text" class="form-control" id="speciesScientificName" required>
                                <div class="invalid-feedback">Please provide the scientific name.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="speciesCommonName" class="form-label">Common Name</label>
                                <input type="text" class="form-control" id="speciesCommonName">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="speciesType" class="form-label">Type *</label>
                                <select class="form-select" id="speciesType" required>
                                    <option value="" selected disabled>Select type...</option>
                                    <option value="flora">Flora</option>
                                    <option value="fauna">Fauna</option>
                                    <option value="fungi">Fungi</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="invalid-feedback">Please select a type.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="speciesStatus" class="form-label">Status *</label>
                                <select class="form-select" id="speciesStatus" required>
                                    <option value="" selected disabled>Select status...</option>
                                    <option value="native">Native</option>
                                    <option value="introduced">Introduced</option>
                                    <option value="weed">Weed</option>
                                    <option value="pest">Pest</option>
                                    <option value="endangered">Endangered</option>
                                    <option value="vulnerable">Vulnerable</option>
                                    <option value="threatened">Threatened</option>
                                </select>
                                <div class="invalid-feedback">Please select a status.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="speciesDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="speciesDescription" rows="3"></textarea>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="speciesHabitat" class="form-label">Habitat</label>
                                <input type="text" class="form-control" id="speciesHabitat">
                            </div>
                            <div class="col-md-6">
                                <label for="speciesLastObserved" class="form-label">Last Observed</label>
                                <input type="date" class="form-control" id="speciesLastObserved">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="speciesImage" class="form-label">Image</label>
                            <input class="form-control" type="file" id="speciesImage" accept="image/*">
                            <img id="speciesImagePreview" class="species-image-preview" src="#" alt="Species image preview">
                        </div>

                        <div class="mb-3">
                            <label for="speciesNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="speciesNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveSpecies">Save Species</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Monitoring Modal -->
    <div class="modal fade" id="newMonitoringModal" tabindex="-1" aria-labelledby="newMonitoringModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newMonitoringModalLabel">New Monitoring Activity</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="monitoringForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="monitoringType" class="form-label">Monitoring Type *</label>
                                <select class="form-select" id="monitoringType" required>
                                    <option value="" selected disabled>Select type...</option>
                                    <option value="fauna-survey">Fauna Survey</option>
                                    <option value="vegetation-survey">Vegetation Survey</option>
                                    <option value="water-quality">Water Quality Testing</option>
                                    <option value="weed-mapping">Weed Mapping</option>
                                    <option value="erosion-monitoring">Erosion Monitoring</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="invalid-feedback">Please select a monitoring type.</div>
                            </div>
                            <div class="col-md-6">
                                <label for="monitoringDate" class="form-label">Date *</label>
                                <input type="date" class="form-control" id="monitoringDate" required>
                                <div class="invalid-feedback">Please provide a date.</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringLocation" class="form-label">Location *</label>
                            <input type="text" class="form-control" id="monitoringLocation" required>
                            <div class="invalid-feedback">Please provide a location.</div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringObserver" class="form-label">Observer *</label>
                            <input type="text" class="form-control" id="monitoringObserver" required>
                            <div class="invalid-feedback">Please specify the observer.</div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringFindings" class="form-label">Findings *</label>
                            <textarea class="form-control" id="monitoringFindings" rows="3" required></textarea>
                            <div class="invalid-feedback">Please provide findings.</div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringSpecies" class="form-label">Species Observed (if applicable)</label>
                            <select class="form-select" id="monitoringSpecies" multiple>
                                <!-- Species options will be loaded here dynamically -->
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringPhotos" class="form-label">Upload Photos</label>
                            <input class="form-control" type="file" id="monitoringPhotos" multiple accept="image/*">
                            <div class="image-preview-container" id="monitoringPhotoPreview"></div>
                        </div>

                        <div class="mb-3">
                            <label for="monitoringNotes" class="form-label">Notes</label>
                            <textarea class="form-control" id="monitoringNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveMonitoring">Save Monitoring</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Assessment Modal -->
    <div class="modal fade" id="viewAssessmentModal" tabindex="-1" aria-labelledby="viewAssessmentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewAssessmentModalLabel">Assessment Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="assessmentModalBody">
                    <!-- Assessment details will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printAssessment">Export PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Generate Report Modal -->
    <div class="modal fade" id="generateReportModal" tabindex="-1" aria-labelledby="generateReportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="generateReportModalLabel">Generate Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="reportForm">
                        <div class="mb-3">
                            <label for="reportType" class="form-label">Report Type *</label>
                            <select class="form-select" id="reportType" required>
                                <option value="" selected disabled>Select report type...</option>
                                <option value="compliance">Compliance Report</option>
                                <option value="maintenance">Maintenance Summary</option>
                                <option value="monitoring">Monitoring Summary</option>
                                <option value="health-trend">Ecosystem Health Trend</option>
                                <option value="threat-management">Threat Management</option>
                            </select>
                            <div class="invalid-feedback">Please select a report type.</div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="reportStartDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="reportStartDate">
                            </div>
                            <div class="col-md-6">
                                <label for="reportEndDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="reportEndDate">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="reportFormat" class="form-label">Format *</label>
                            <select class="form-select" id="reportFormat" required>
                                <option value="pdf" selected>PDF</option>
                                <option value="excel">Excel</option>
                                <option value="word">Word</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="generateReportBtn">Generate</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Report Modal -->
    <div class="modal fade" id="viewReportModal" tabindex="-1" aria-labelledby="viewReportModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewReportModalLabel">Report Preview</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="reportModalBody">
                    <!-- Report content will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="downloadReport">Download</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Species Modal -->
    <div class="modal fade" id="viewSpeciesModal" tabindex="-1" aria-labelledby="viewSpeciesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewSpeciesModalLabel">Species Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="speciesModalBody">
                    <!-- Species details will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printSpeciesDetails">Export PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Activity Modal -->
    <div class="modal fade" id="viewActivityModal" tabindex="-1" aria-labelledby="viewActivityModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewActivityModalLabel">Activity Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="activityModalBody">
                    <!-- Activity details will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printActivity">Export PDF</button>
                    <button type="button" class="btn btn-success" id="completeActivity">Mark Complete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Monitoring Modal -->
    <div class="modal fade" id="viewMonitoringModal" tabindex="-1" aria-labelledby="viewMonitoringModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewMonitoringModalLabel">Monitoring Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="monitoringModalBody">
                    <!-- Monitoring details will be loaded here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printMonitoring">Export PDF</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Confirm Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirmationModalBody">
                    Are you sure you want to perform this action?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmAction">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Data storage and management
        const db = {
            assessments: JSON.parse(localStorage.getItem('assessments')) || [],
            species: JSON.parse(localStorage.getItem('species')) || [],
            activities: JSON.parse(localStorage.getItem('activities')) || [],
            monitoring: JSON.parse(localStorage.getItem('monitoring')) || [],
            reports: JSON.parse(localStorage.getItem('reports')) || [],
            complianceChecklist: JSON.parse(localStorage.getItem('complianceChecklist')) || [
                { id: 1, requirement: "Identified all relevant legislation", compliant: "", evidence: "", notes: "" },
                { id: 2, requirement: "Assessed impacts on protected matters", compliant: "", evidence: "", notes: "" },
                { id: 3, requirement: "Obtained necessary permits/approvals", compliant: "", evidence: "", notes: "" },
                { id: 4, requirement: "Implemented required protections", compliant: "", evidence: "", notes: "" },
                { id: 5, requirement: "Maintained required records", compliant: "", evidence: "", notes: "" }
            ],
            settings: JSON.parse(localStorage.getItem('settings')) || {
                siteName: "Conservation Area",
                siteLocation: "Location",
                siteArea: 0,
                siteDescription: "Description of the site",
                userProfile: {
                    name: "User Name",
                    email: "user@example.com",
                    role: "user"
                }
            }
        };

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('assessments', JSON.stringify(db.assessments));
            localStorage.setItem('species', JSON.stringify(db.species));
            localStorage.setItem('activities', JSON.stringify(db.activities));
            localStorage.setItem('monitoring', JSON.stringify(db.monitoring));
            localStorage.setItem('reports', JSON.stringify(db.reports));
            localStorage.setItem('complianceChecklist', JSON.stringify(db.complianceChecklist));
            localStorage.setItem('settings', JSON.stringify(db.settings));
        }

        // Show toast notification
        function showToast(title, message, type = 'success') {
            const toastEl = document.getElementById('liveToast');
            const toastTitle = document.getElementById('toast-title');
            const toastMessage = document.getElementById('toast-message');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            // Remove previous color classes
            toastEl.classList.remove('bg-success', 'bg-danger', 'bg-warning', 'bg-info');
            
            // Add appropriate color class based on type
            switch(type) {
                case 'success':
                    toastEl.classList.add('bg-success');
                    break;
                case 'error':
                    toastEl.classList.add('bg-danger');
                    break;
                case 'warning':
                    toastEl.classList.add('bg-warning');
                    break;
                case 'info':
                    toastEl.classList.add('bg-info');
                    break;
                default:
                    toastEl.classList.add('bg-success');
            }
            
            const toast = new bootstrap.Toast(toastEl);
            toast.show();
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize components
            initMap();
            loadDashboard();
            loadAssessments();
            loadSpecies();
            loadActivities();
            loadMonitoring();
            loadReports();
            loadComplianceChecklist();
            
            // Set up event listeners
            setupEventListeners();
        });

        // Initialize map
        function initMap() {
            // Initialize the map with default coordinates
            window.map = L.map('map').setView([-27.4698, 153.0251], 13); // Default to Brisbane coordinates

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(window.map);

            // Add a default marker
            const marker = L.marker([-27.4698, 153.0251]).addTo(window.map)
                .bindPopup('Default Location')
                .openPopup();

            // Create layer groups for different map features
            window.zonesLayer = L.layerGroup([marker]);
            window.vegetationLayer = L.layerGroup();
            window.weedsLayer = L.layerGroup();

            // Add layer control
            const baseLayers = {
                "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                })
            };

            const overlays = {
                "Zones": window.zonesLayer,
                "Vegetation": window.vegetationLayer,
                "Weeds": window.weedsLayer
            };

            L.control.layers(baseLayers, overlays, {collapsed: false}).addTo(window.map);

            // Default to showing zones
            window.zonesLayer.addTo(window.map);

            // Button controls for map layers
            document.getElementById('zoneToggle').addEventListener('click', function() {
                if (window.map.hasLayer(window.zonesLayer)) {
                    window.map.removeLayer(window.zonesLayer);
                    this.classList.remove('active');
                } else {
                    window.map.addLayer(window.zonesLayer);
                    this.classList.add('active');
                }
            });

            document.getElementById('vegetationToggle').addEventListener('click', function() {
                if (window.map.hasLayer(window.vegetationLayer)) {
                    window.map.removeLayer(window.vegetationLayer);
                    this.classList.remove('active');
                } else {
                    window.map.addLayer(window.vegetationLayer);
                    this.classList.add('active');
                }
            });

            document.getElementById('weedsToggle').addEventListener('click', function() {
                if (window.map.hasLayer(window.weedsLayer)) {
                    window.map.removeLayer(window.weedsLayer);
                    this.classList.remove('active');
                } else {
                    window.map.addLayer(window.weedsLayer);
                    this.classList.add('active');
                }
            });
        }

        // Load dashboard data
        function loadDashboard() {
            // Upcoming tasks
            const upcomingTasks = db.activities
                .filter(a => a.status !== 'completed' && a.status !== 'cancelled')
                .sort((a, b) => new Date(a.startDate) - new Date(b.startDate))
                .slice(0, 3);
            
            const upcomingTasksList = document.getElementById('upcomingTasksList');
            upcomingTasksList.innerHTML = '';
            
            if (upcomingTasks.length === 0) {
                upcomingTasksList.innerHTML = '<div class="list-group-item">No upcoming tasks</div>';
            } else {
                upcomingTasks.forEach(task => {
                    const taskEl = document.createElement('a');
                    taskEl.href = '#';
                    taskEl.className = 'list-group-item list-group-item-action';
                    taskEl.innerHTML = `
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${task.title}</h6>
                            <small class="text-muted">${formatDate(task.startDate)}</small>
                        </div>
                        <p class="mb-1">${task.description.substring(0, 50)}${task.description.length > 50 ? '...' : ''}</p>
                        <small class="text-muted">Assigned to: ${task.assignedTo}</small>
                    `;
                    taskEl.addEventListener('click', () => showActivityDetails(task));
                    upcomingTasksList.appendChild(taskEl);
                });
            }
            
            // Recent observations
            const recentObservations = db.monitoring
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 4);
            
            const recentObservationsList = document.getElementById('recentObservationsList');
            recentObservationsList.innerHTML = '';
            
            if (recentObservations.length === 0) {
                recentObservationsList.innerHTML = '<li class="list-group-item">No recent observations</li>';
            } else {
                recentObservations.forEach(obs => {
                    const obsEl = document.createElement('li');
                    obsEl.className = 'list-group-item d-flex justify-content-between align-items-center';
                    obsEl.innerHTML = `
                        ${obs.type === 'fauna-survey' ? 'Fauna sighting' : 'Vegetation survey'}
                        <span class="badge ${obs.type === 'fauna-survey' ? 'bg-info' : 'bg-success'} rounded-pill">
                            ${obs.type === 'fauna-survey' ? 'Fauna' : 'Flora'}
                        </span>
                    `;
                    recentObservationsList.appendChild(obsEl);
                });
            }
            
            // Compliance checklist
            const complianceChecklist = document.getElementById('complianceChecklist');
            complianceChecklist.innerHTML = '';
            
            const completedItems = db.complianceChecklist.filter(item => item.compliant === 'Yes').length;
            const totalItems = db.complianceChecklist.length;
            const progressPercentage = Math.round((completedItems / totalItems) * 100);
            
            document.getElementById('complianceProgress').style.width = `${progressPercentage}%`;
            document.getElementById('complianceProgress').textContent = `${progressPercentage}% Complete`;
            document.getElementById('complianceProgress').setAttribute('aria-valuenow', progressPercentage);
            
            db.complianceChecklist.forEach(item => {
                const checkEl = document.createElement('div');
                checkEl.className = 'form-check mb-2';
                checkEl.innerHTML = `
                    <input class="form-check-input" type="checkbox" id="check${item.id}" ${item.compliant === 'Yes' ? 'checked' : ''}>
                    <label class="form-check-label" for="check${item.id}">
                        ${item.requirement}
                    </label>
                `;
                complianceChecklist.appendChild(checkEl);
            });
        }

        // Load assessments
        function loadAssessments() {
            const assessmentsTable = document.getElementById('assessmentsTable').getElementsByTagName('tbody')[0];
            assessmentsTable.innerHTML = '';
            
            db.assessments.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(assessment => {
                const row = assessmentsTable.insertRow();
                row.innerHTML = `
                    <td>${formatDate(assessment.date)}</td>
                    <td>${assessment.assessor}</td>
                    <td><span class="badge ${getHealthBadgeClass(assessment.health)}">${capitalizeFirstLetter(assessment.health)}</span></td>
                    <td>${assessment.threats.join(', ') || 'None'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary view-assessment" data-id="${assessment.id}">View</button>
                        <button class="btn btn-sm btn-outline-secondary export-assessment" data-id="${assessment.id}">PDF</button>
                    </td>
                `;
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-assessment').forEach(btn => {
                btn.addEventListener('click', function() {
                    const assessmentId = this.getAttribute('data-id');
                    const assessment = db.assessments.find(a => a.id == assessmentId);
                    if (assessment) {
                        showAssessmentDetails(assessment);
                    }
                });
            });
        }

        // Load species
        function loadSpecies() {
            // Species cards
            const speciesCardsContainer = document.getElementById('speciesCardsContainer');
            speciesCardsContainer.innerHTML = '';
            
            const recentSpecies = db.species
                .sort((a, b) => new Date(b.lastObserved || 0) - new Date(a.lastObserved || 0))
                .slice(0, 3);
            
            if (recentSpecies.length === 0) {
                speciesCardsContainer.innerHTML = '<div class="col-12"><p>No species recorded yet.</p></div>';
            } else {
                recentSpecies.forEach(species => {
                    const cardCol = document.createElement('div');
                    cardCol.className = 'col-md-4 mb-4';
                    cardCol.innerHTML = `
                        <div class="card h-100">
                            <img src="${species.image || 'https://via.placeholder.com/300x200?text=No+image'}" class="card-img-top" alt="${species.scientificName}">
                            <div class="card-body">
                                <h5 class="card-title">${species.scientificName}</h5>
                                <h6 class="card-subtitle mb-2 text-muted">${species.commonName || 'No common name'}</h6>
                                <p class="card-text">
                                    <span class="badge ${getSpeciesStatusBadgeClass(species.status)} me-1">${capitalizeFirstLetter(species.status)}</span>
                                    ${species.type === 'weed' || species.type === 'pest' ? `<span class="badge bg-warning">High priority</span>` : ''}
                                </p>
                                <p class="card-text"><small>Last observed: ${species.lastObserved ? formatDate(species.lastObserved) : 'Not recorded'}</small></p>
                                <button class="btn btn-sm btn-outline-primary view-species" data-id="${species.id}">View Details</button>
                            </div>
                        </div>
                    `;
                    speciesCardsContainer.appendChild(cardCol);
                });
            }
            
            // Species table
            const speciesTable = document.getElementById('speciesTable').getElementsByTagName('tbody')[0];
            speciesTable.innerHTML = '';
            
            db.species.forEach(species => {
                const row = speciesTable.insertRow();
                row.innerHTML = `
                    <td>${species.scientificName}</td>
                    <td>${species.commonName || '-'}</td>
                    <td>${capitalizeFirstLetter(species.type)}</td>
                    <td><span class="badge ${getSpeciesStatusBadgeClass(species.status)}">${capitalizeFirstLetter(species.status)}</span></td>
                    <td>${species.lastObserved ? formatDate(species.lastObserved) : 'Not recorded'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary view-species" data-id="${species.id}">View</button>
                        <button class="btn btn-sm btn-outline-secondary map-species" data-id="${species.id}">Map</button>
                    </td>
                `;
            });
            
            // Add event listeners to species buttons
            document.querySelectorAll('.view-species').forEach(btn => {
                btn.addEventListener('click', function() {
                    const speciesId = this.getAttribute('data-id');
                    const species = db.species.find(s => s.id == speciesId);
                    if (species) {
                        showSpeciesDetails(species);
                    }
                });
            });
        }

        // Load activities
        function loadActivities() {
            // Upcoming activities
            const upcomingTable = document.getElementById('upcomingActivitiesTable').getElementsByTagName('tbody')[0];
            upcomingTable.innerHTML = '';
            
            const upcomingActivities = db.activities
                .filter(a => a.status === 'planned' || a.status === 'in-progress')
                .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            if (upcomingActivities.length === 0) {
                upcomingTable.innerHTML = '<tr><td colspan="7" class="text-center">No upcoming activities</td></tr>';
            } else {
                upcomingActivities.forEach(activity => {
                    const row = upcomingTable.insertRow();
                    row.innerHTML = `
                        <td>${activity.title}</td>
                        <td>${formatActivityType(activity.type)}</td>
                        <td>${formatDate(activity.startDate)}</td>
                        <td>${activity.location}</td>
                        <td>${activity.assignedTo}</td>
                        <td><span class="badge ${getStatusBadgeClass(activity.status)}">${capitalizeFirstLetter(activity.status)}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-activity" data-id="${activity.id}">Details</button>
                        </td>
                    `;
                });
            }
            
            // Completed activities
            const completedTable = document.getElementById('completedActivitiesTable').getElementsByTagName('tbody')[0];
            completedTable.innerHTML = '';
            
            const completedActivities = db.activities
                .filter(a => a.status === 'completed')
                .sort((a, b) => new Date(b.endDate || b.startDate) - new Date(a.endDate || a.startDate));
            
            if (completedActivities.length === 0) {
                completedTable.innerHTML = '<tr><td colspan="7" class="text-center">No completed activities</td></tr>';
            } else {
                completedActivities.forEach(activity => {
                    const row = completedTable.insertRow();
                    row.innerHTML = `
                        <td>${activity.title}</td>
                        <td>${formatActivityType(activity.type)}</td>
                        <td>${formatDate(activity.endDate || activity.startDate)}</td>
                        <td>${activity.location}</td>
                        <td>${activity.assignedTo}</td>
                        <td><span class="badge ${getStatusBadgeClass(activity.status)}">${capitalizeFirstLetter(activity.status)}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-activity" data-id="${activity.id}">Details</button>
                        </td>
                    `;
                });
            }
            
            // Overdue activities
            const overdueTable = document.getElementById('overdueActivitiesTable').getElementsByTagName('tbody')[0];
            overdueTable.innerHTML = '';
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const overdueActivities = db.activities
                .filter(a => (a.status === 'planned' || a.status === 'in-progress') && new Date(a.startDate) < today)
                .sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
            
            if (overdueActivities.length === 0) {
                overdueTable.innerHTML = '<tr><td colspan="7" class="text-center">No overdue activities</td></tr>';
            } else {
                overdueActivities.forEach(activity => {
                    const row = overdueTable.insertRow();
                    row.innerHTML = `
                        <td>${activity.title}</td>
                        <td>${formatActivityType(activity.type)}</td>
                        <td>${formatDate(activity.startDate)}</td>
                        <td>${activity.location}</td>
                        <td>${activity.assignedTo}</td>
                        <td><span class="badge bg-danger">Overdue</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-activity" data-id="${activity.id}">Details</button>
                            <button class="btn btn-sm btn-warning reschedule-activity" data-id="${activity.id}">Reschedule</button>
                        </td>
                    `;
                });
            }
            
            // Add event listeners to activity buttons
            document.querySelectorAll('.view-activity').forEach(btn => {
                btn.addEventListener('click', function() {
                    const activityId = this.getAttribute('data-id');
                    const activity = db.activities.find(a => a.id == activityId);
                    if (activity) {
                        showActivityDetails(activity);
                    }
                });
            });
        }

        // Load monitoring
        function loadMonitoring() {
            const monitoringTable = document.getElementById('monitoringTable').getElementsByTagName('tbody')[0];
            monitoringTable.innerHTML = '';
            
            db.monitoring.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(monitoring => {
                const row = monitoringTable.insertRow();
                row.innerHTML = `
                    <td>${formatDate(monitoring.date)}</td>
                    <td>${formatMonitoringType(monitoring.type)}</td>
                    <td>${monitoring.location}</td>
                    <td>${monitoring.observer}</td>
                    <td>${monitoring.findings.substring(0, 50)}${monitoring.findings.length > 50 ? '...' : ''}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary view-monitoring" data-id="${monitoring.id}">View</button>
                        <button class="btn btn-sm btn-outline-secondary export-monitoring" data-id="${monitoring.id}">PDF</button>
                    </td>
                `;
            });
            
            // Add event listeners to monitoring buttons
            document.querySelectorAll('.view-monitoring').forEach(btn => {
                btn.addEventListener('click', function() {
                    const monitoringId = this.getAttribute('data-id');
                    const monitoring = db.monitoring.find(m => m.id == monitoringId);
                    if (monitoring) {
                        showMonitoringDetails(monitoring);
                    }
                });
            });
        }

        // Load reports
        function loadReports() {
            const reportsTable = document.getElementById('reportsTable').getElementsByTagName('tbody')[0];
            reportsTable.innerHTML = '';
            
            db.reports.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(report => {
                const row = reportsTable.insertRow();
                row.innerHTML = `
                    <td>${formatDate(report.date)}</td>
                    <td>${formatReportType(report.type)}</td>
                    <td>${report.generatedBy}</td>
                    <td>${report.period || 'N/A'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary view-report" data-id="${report.id}">View</button>
                        <button class="btn btn-sm btn-outline-secondary download-report" data-id="${report.id}">PDF</button>
                    </td>
                `;
            });
            
            // Add event listeners to report buttons
            document.querySelectorAll('.view-report').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reportId = this.getAttribute('data-id');
                    const report = db.reports.find(r => r.id == reportId);
                    if (report) {
                        showReportDetails(report);
                    }
                });
            });
        }

        // Load compliance checklist
        function loadComplianceChecklist() {
            const complianceTable = document.getElementById('complianceChecklistTable')?.getElementsByTagName('tbody')[0];
            if (!complianceTable) return;
            
            complianceTable.innerHTML = '';
            
            db.complianceChecklist.forEach(item => {
                const row = complianceTable.insertRow();
                row.innerHTML = `
                    <td>${item.requirement}</td>
                    <td>
                        <select class="form-select form-select-sm compliance-status" data-id="${item.id}">
                            <option value="" ${item.compliant === '' ? 'selected' : ''}>Select...</option>
                            <option value="Yes" ${item.compliant === 'Yes' ? 'selected' : ''}>Yes</option>
                            <option value="No" ${item.compliant === 'No' ? 'selected' : ''}>No</option>
                            <option value="Partial" ${item.compliant === 'Partial' ? 'selected' : ''}>Partial</option>
                        </select>
                    </td>
                    <td>
                        <input type="text" class="form-control form-control-sm compliance-evidence" data-id="${item.id}" value="${item.evidence || ''}" placeholder="Document reference">
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary compliance-note" data-id="${item.id}">Add Note</button>
                    </td>
                `;
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            // Assessment form submission
            document.getElementById('assessmentForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveAssessment();
            });
            
            // Activity form submission
            document.getElementById('saveActivity').addEventListener('click', function() {
                saveActivity();
            });
            
            // Species form submission
            document.getElementById('saveSpecies').addEventListener('click', function() {
                saveSpecies();
            });
            
            // Monitoring form submission
            document.getElementById('saveMonitoring').addEventListener('click', function() {
                saveMonitoring();
            });
            
            // Generate compliance report
            document.getElementById('generateComplianceReport').addEventListener('click', function() {
                generateComplianceReport();
            });
            
            // Generate report button
            document.getElementById('generateReportBtn').addEventListener('click', function() {
                generateReportFromModal();
            });
            
            // Species image preview
            document.getElementById('speciesImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const preview = document.getElementById('speciesImagePreview');
                        preview.src = event.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Assessment photo preview
            document.getElementById('assessmentPhotos').addEventListener('change', function(e) {
                const files = e.target.files;
                const previewContainer = document.getElementById('assessmentPhotoPreview');
                previewContainer.innerHTML = '';
                
                if (files.length > 0) {
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        if (file.type.match('image.*')) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                const img = document.createElement('img');
                                img.src = event.target.result;
                                img.className = 'image-thumbnail';
                                previewContainer.appendChild(img);
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                }
            });
            
            // Monitoring photo preview
            document.getElementById('monitoringPhotos').addEventListener('change', function(e) {
                const files = e.target.files;
                const previewContainer = document.getElementById('monitoringPhotoPreview');
                previewContainer.innerHTML = '';
                
                if (files.length > 0) {
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        if (file.type.match('image.*')) {
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                const img = document.createElement('img');
                                img.src = event.target.result;
                                img.className = 'image-thumbnail';
                                previewContainer.appendChild(img);
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                }
            });
            
            // Tab change events to refresh data
            const tabLinks = document.querySelectorAll('.nav-link[data-bs-toggle="tab"]');
            tabLinks.forEach(link => {
                link.addEventListener('shown.bs.tab', function(e) {
                    const target = e.target.getAttribute('href');
                    if (target === '#dashboard') {
                        loadDashboard();
                    } else if (target === '#site-assessment') {
                        loadAssessments();
                    } else if (target === '#maintenance-plan') {
                        loadActivities();
                    } else if (target === '#species-register') {
                        loadSpecies();
                    } else if (target === '#monitoring') {
                        loadMonitoring();
                    } else if (target === '#reports') {
                        loadReports();
                    }
                });
            });
            
            // Validate components selection
            const componentCheckboxes = document.querySelectorAll('input[name="components"]');
            componentCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    validateComponents();
                });
            });
            
            // PDF export buttons
            document.getElementById('printAssessment').addEventListener('click', exportToPDF);
            document.getElementById('printSpeciesDetails').addEventListener('click', exportToPDF);
            document.getElementById('printActivity').addEventListener('click', exportToPDF);
            document.getElementById('printMonitoring').addEventListener('click', exportToPDF);
            document.getElementById('downloadReport').addEventListener('click', exportToPDF);
        }

        // Save assessment
        function saveAssessment() {
            const form = document.getElementById('assessmentForm');
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                validateComponents();
                return;
            }
            
            const selectedComponents = Array.from(document.querySelectorAll('input[name="components"]:checked')).map(cb => cb.value);
            if (selectedComponents.length === 0) {
                document.getElementById('componentsFeedback').style.display = 'block';
                return;
            }
            
            const threats = Array.from(document.getElementById('threats').selectedOptions).map(opt => opt.value);
            
            const newAssessment = {
                id: Date.now(),
                date: document.getElementById('assessmentDate').value,
                assessor: document.getElementById('assessorName').value,
                description: document.getElementById('siteDescription').value,
                components: selectedComponents,
                health: document.getElementById('ecosystemHealth').value,
                threats: threats,
                photos: [], // Would be handled with file upload in a real app
                createdAt: new Date().toISOString()
            };
            
            db.assessments.push(newAssessment);
            saveData();
            
            // Reset form
            form.reset();
            form.classList.remove('was-validated');
            document.getElementById('assessmentPhotoPreview').innerHTML = '';
            
            // Show success message
            showToast('Success', 'Assessment saved successfully!');
            
            // Reload assessments
            loadAssessments();
        }

        // Save activity
        function saveActivity() {
            const form = document.getElementById('activityForm');
            const fields = ['activityType', 'activityTitle', 'activityStartDate', 'activityLocation', 'activityDescription', 'activityAssignedTo'];
            
            let isValid = true;
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (!element.value) {
                    element.classList.add('is-invalid');
                    isValid = false;
                } else {
                    element.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) return;
            
            const newActivity = {
                id: Date.now(),
                type: document.getElementById('activityType').value,
                title: document.getElementById('activityTitle').value,
                startDate: document.getElementById('activityStartDate').value,
                endDate: document.getElementById('activityEndDate').value || null,
                location: document.getElementById('activityLocation').value,
                description: document.getElementById('activityDescription').value,
                assignedTo: document.getElementById('activityAssignedTo').value,
                priority: document.getElementById('activityPriority').value,
                status: document.getElementById('activityStatus').value,
                notes: document.getElementById('activityNotes').value,
                createdAt: new Date().toISOString()
            };
            
            db.activities.push(newActivity);
            saveData();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('newActivityModal'));
            modal.hide();
            
            // Show success message
            showToast('Success', 'Activity saved successfully!');
            
            // Reload activities
            loadActivities();
        }

        // Save species
        function saveSpecies() {
            const form = document.getElementById('speciesForm');
            const fields = ['speciesScientificName', 'speciesType', 'speciesStatus'];
            
            let isValid = true;
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (!element.value) {
                    element.classList.add('is-invalid');
                    isValid = false;
                } else {
                    element.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) return;
            
            // Handle image upload (simplified for demo)
            let image = '';
            const fileInput = document.getElementById('speciesImage');
            if (fileInput.files.length > 0) {
                image = URL.createObjectURL(fileInput.files[0]);
            }
            
            const newSpecies = {
                id: Date.now(),
                scientificName: document.getElementById('speciesScientificName').value,
                commonName: document.getElementById('speciesCommonName').value || null,
                type: document.getElementById('speciesType').value,
                status: document.getElementById('speciesStatus').value,
                description: document.getElementById('speciesDescription').value,
                habitat: document.getElementById('speciesHabitat').value || null,
                lastObserved: document.getElementById('speciesLastObserved').value || null,
                image: image,
                notes: document.getElementById('speciesNotes').value,
                createdAt: new Date().toISOString()
            };
            
            db.species.push(newSpecies);
            saveData();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('newSpeciesModal'));
            modal.hide();
            
            // Show success message
            showToast('Success', 'Species record saved successfully!');
            
            // Reload species
            loadSpecies();
        }

        // Save monitoring
        function saveMonitoring() {
            const form = document.getElementById('monitoringForm');
            const fields = ['monitoringType', 'monitoringDate', 'monitoringLocation', 'monitoringObserver', 'monitoringFindings'];
            
            let isValid = true;
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (!element.value) {
                    element.classList.add('is-invalid');
                    isValid = false;
                } else {
                    element.classList.remove('is-invalid');
                }
            });
            
            if (!isValid) return;
            
            // Handle species selection
            const selectedSpecies = Array.from(document.getElementById('monitoringSpecies').selectedOptions).map(opt => opt.value);
            
            // Handle photo upload (simplified for demo)
            const photos = [];
            const fileInput = document.getElementById('monitoringPhotos');
            if (fileInput.files.length > 0) {
                for (let i = 0; i < fileInput.files.length; i++) {
                    if (fileInput.files[i].type.match('image.*')) {
                        photos.push(URL.createObjectURL(fileInput.files[i]));
                    }
                }
            }
            
            const newMonitoring = {
                id: Date.now(),
                type: document.getElementById('monitoringType').value,
                date: document.getElementById('monitoringDate').value,
                location: document.getElementById('monitoringLocation').value,
                observer: document.getElementById('monitoringObserver').value,
                findings: document.getElementById('monitoringFindings').value,
                species: selectedSpecies,
                photos: photos,
                notes: document.getElementById('monitoringNotes').value,
                createdAt: new Date().toISOString()
            };
            
            db.monitoring.push(newMonitoring);
            saveData();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('newMonitoringModal'));
            modal.hide();
            
            // Show success message
            showToast('Success', 'Monitoring record saved successfully!');
            
            // Reload monitoring
            loadMonitoring();
        }

        // Generate compliance report
        function generateComplianceReport() {
            const completedItems = db.complianceChecklist.filter(item => item.compliant === 'Yes').length;
            const totalItems = db.complianceChecklist.length;
            const progressPercentage = Math.round((completedItems / totalItems) * 100);
            
            const newReport = {
                id: Date.now(),
                type: 'compliance',
                date: new Date().toISOString(),
                generatedBy: db.settings.userProfile.name,
                content: {
                    progress: progressPercentage,
                    checklist: db.complianceChecklist,
                    summary: `Compliance progress: ${progressPercentage}% complete`
                },
                createdAt: new Date().toISOString()
            };
            
            db.reports.push(newReport);
            saveData();
            
            // Show the report
            showReportDetails(newReport);
            
            // Show success message
            showToast('Success', 'Compliance report generated successfully!');
        }

        // Generate report
        function generateReport(type) {
            let reportTitle = '';
            let reportContent = '';
            
            switch(type) {
                case 'compliance':
                    reportTitle = 'Compliance Report';
                    reportContent = 'This report shows compliance with requirements.';
                    break;
                case 'maintenance':
                    reportTitle = 'Maintenance Summary';
                    reportContent = 'Summary of all maintenance activities.';
                    break;
                case 'monitoring':
                    reportTitle = 'Monitoring Summary';
                    reportContent = 'Summary of monitoring activities and findings.';
                    break;
                case 'health-trend':
                    reportTitle = 'Ecosystem Health Trend';
                    reportContent = 'Trend report showing changes in ecosystem health over time.';
                    break;
                case 'threat-management':
                    reportTitle = 'Threat Management Report';
                    reportContent = 'Report on threats and management actions taken.';
                    break;
                default:
                    reportTitle = 'Custom Report';
                    reportContent = 'Custom generated report.';
            }
            
            const newReport = {
                id: Date.now(),
                type: type,
                date: new Date().toISOString(),
                generatedBy: db.settings.userProfile.name,
                content: {
                    title: reportTitle,
                    body: reportContent,
                    data: type === 'maintenance' ? db.activities : 
                          type === 'monitoring' ? db.monitoring :
                          type === 'health-trend' ? db.assessments :
                          type === 'threat-management' ? db.complianceChecklist : []
                },
                createdAt: new Date().toISOString()
            };
            
            db.reports.push(newReport);
            saveData();
            
            // Show the report
            showReportDetails(newReport);
            
            // Show success message
            showToast('Success', `${reportTitle} generated successfully!`);
        }

        // Generate report from modal
        function generateReportFromModal() {
            const type = document.getElementById('reportType').value;
            if (!type) {
                document.getElementById('reportType').classList.add('is-invalid');
                return;
            }
            
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const format = document.getElementById('reportFormat').value;
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('generateReportModal'));
            modal.hide();
            
            // Generate the report
            generateReport(type);
        }

        // Show assessment details
        function showAssessmentDetails(assessment) {
            const modalBody = document.getElementById('assessmentModalBody');
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Assessment Date</h6>
                        <p>${formatDate(assessment.date)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Assessor</h6>
                        <p>${assessment.assessor}</p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Site Description</h6>
                    <p>${assessment.description}</p>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Ecosystem Components Present</h6>
                        <ul>
                            ${assessment.components.map(c => `<li>${capitalizeFirstLetter(c)}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Health Assessment</h6>
                        <span class="badge ${getHealthBadgeClass(assessment.health)}">${capitalizeFirstLetter(assessment.health)}</span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Identified Threats</h6>
                    <p>${assessment.threats.length > 0 ? assessment.threats.map(t => capitalizeFirstLetter(t)).join(', ') : 'None identified'}</p>
                </div>
                
                ${assessment.photos.length > 0 ? `
                <div class="mb-3">
                    <h6>Photos</h6>
                    <div class="d-flex flex-wrap gap-2">
                        ${assessment.photos.map(photo => `
                            <img src="${photo}" alt="Assessment photo" class="img-thumbnail" style="max-height: 150px;">
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('viewAssessmentModal'));
            modal.show();
        }

        // Show species details
        function showSpeciesDetails(species) {
            const modalBody = document.getElementById('speciesModalBody');
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Scientific Name</h6>
                        <p>${species.scientificName}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Common Name</h6>
                        <p>${species.commonName || 'Not specified'}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Type</h6>
                        <p>${capitalizeFirstLetter(species.type)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Status</h6>
                        <span class="badge ${getSpeciesStatusBadgeClass(species.status)}">${capitalizeFirstLetter(species.status)}</span>
                    </div>
                </div>
                
                ${species.description ? `
                <div class="mb-3">
                    <h6>Description</h6>
                    <p>${species.description}</p>
                </div>
                ` : ''}
                
                ${species.habitat ? `
                <div class="mb-3">
                    <h6>Habitat</h6>
                    <p>${species.habitat}</p>
                </div>
                ` : ''}
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Last Observed</h6>
                        <p>${species.lastObserved ? formatDate(species.lastObserved) : 'Not recorded'}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Record Created</h6>
                        <p>${formatDate(species.createdAt)}</p>
                    </div>
                </div>
                
                ${species.image ? `
                <div class="mb-3">
                    <h6>Image</h6>
                    <img src="${species.image}" alt="${species.scientificName}" class="img-fluid">
                </div>
                ` : ''}
                
                ${species.notes ? `
                <div class="mb-3">
                    <h6>Notes</h6>
                    <p>${species.notes}</p>
                </div>
                ` : ''}
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('viewSpeciesModal'));
            modal.show();
        }

        // Show activity details
        function showActivityDetails(activity) {
            const modalBody = document.getElementById('activityModalBody');
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Activity Type</h6>
                        <p>${formatActivityType(activity.type)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Title</h6>
                        <p>${activity.title}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Start Date</h6>
                        <p>${formatDateTime(activity.startDate)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>${activity.status === 'completed' ? 'Completed' : 'End'} Date</h6>
                        <p>${activity.endDate ? formatDateTime(activity.endDate) : 'Not specified'}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Location</h6>
                        <p>${activity.location}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Assigned To</h6>
                        <p>${activity.assignedTo}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Priority</h6>
                        <p>${capitalizeFirstLetter(activity.priority)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Status</h6>
                        <span class="badge ${getStatusBadgeClass(activity.status)}">${capitalizeFirstLetter(activity.status)}</span>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Description</h6>
                    <p>${activity.description}</p>
                </div>
                
                ${activity.notes ? `
                <div class="mb-3">
                    <h6>Notes</h6>
                    <p>${activity.notes}</p>
                </div>
                ` : ''}
                
                <div class="mb-3">
                    <h6>Record Created</h6>
                    <p>${formatDateTime(activity.createdAt)}</p>
                </div>
            `;
            
            // Set up the complete button if activity is not completed
            const completeBtn = document.getElementById('completeActivity');
            if (activity.status === 'completed') {
                completeBtn.style.display = 'none';
            } else {
                completeBtn.style.display = 'inline-block';
                completeBtn.onclick = function() {
                    completeActivity(activity.id);
                };
            }
            
            const modal = new bootstrap.Modal(document.getElementById('viewActivityModal'));
            modal.show();
        }

        // Show monitoring details
        function showMonitoringDetails(monitoring) {
            const modalBody = document.getElementById('monitoringModalBody');
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Monitoring Type</h6>
                        <p>${formatMonitoringType(monitoring.type)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Date</h6>
                        <p>${formatDate(monitoring.date)}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Location</h6>
                        <p>${monitoring.location}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Observer</h6>
                        <p>${monitoring.observer}</p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6>Findings</h6>
                    <p>${monitoring.findings}</p>
                </div>
                
                ${monitoring.species.length > 0 ? `
                <div class="mb-3">
                    <h6>Species Observed</h6>
                    <ul>
                        ${monitoring.species.map(s => {
                            const species = db.species.find(sp => sp.id == s);
                            return `<li>${species ? species.scientificName + (species.commonName ? ` (${species.commonName})` : '') : s}</li>`;
                        }).join('')}
                    </ul>
                </div>
                ` : ''}
                
                ${monitoring.photos.length > 0 ? `
                <div class="mb-3">
                    <h6>Photos</h6>
                    <div class="d-flex flex-wrap gap-2">
                        ${monitoring.photos.map(photo => `
                            <img src="${photo}" alt="Monitoring photo" class="img-thumbnail" style="max-height: 150px;">
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                ${monitoring.notes ? `
                <div class="mb-3">
                    <h6>Notes</h6>
                    <p>${monitoring.notes}</p>
                </div>
                ` : ''}
                
                <div class="mb-3">
                    <h6>Record Created</h6>
                    <p>${formatDateTime(monitoring.createdAt)}</p>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('viewMonitoringModal'));
            modal.show();
        }

        // Show report details
        function showReportDetails(report) {
            const modalBody = document.getElementById('reportModalBody');
            
            modalBody.innerHTML = `
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Report Type</h6>
                        <p>${formatReportType(report.type)}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Generated On</h6>
                        <p>${formatDateTime(report.date)}</p>
                    </div>
                </div>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <h6>Generated By</h6>
                        <p>${report.generatedBy}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Period</h6>
                        <p>${report.period || 'N/A'}</p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h4>${report.content.title || 'Report'}</h4>
                    <p>${report.content.body || ''}</p>
                </div>
                
                ${report.type === 'compliance' ? `
                <div class="mb-3">
                    <h5>Compliance Progress: ${report.content.progress}%</h5>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: ${report.content.progress}%;" 
                             aria-valuenow="${report.content.progress}" aria-valuemin="0" aria-valuemax="100">
                            ${report.content.progress}%
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h5>Checklist Items</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Requirement</th>
                                <th>Status</th>
                                <th>Evidence</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${report.content.checklist.map(item => `
                                <tr>
                                    <td>${item.requirement}</td>
                                    <td>${item.compliant || 'Not assessed'}</td>
                                    <td>${item.evidence || 'None provided'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                ` : ''}
                
                ${report.type === 'maintenance' ? `
                <div class="mb-3">
                    <h5>Maintenance Activities</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Activity</th>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${report.content.data.slice(0, 10).map(activity => `
                                <tr>
                                    <td>${activity.title}</td>
                                    <td>${formatActivityType(activity.type)}</td>
                                    <td>${formatDate(activity.startDate)}</td>
                                    <td>${capitalizeFirstLetter(activity.status)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    ${report.content.data.length > 10 ? `<p>... and ${report.content.data.length - 10} more activities</p>` : ''}
                </div>
                ` : ''}
                
                ${report.type === 'monitoring' ? `
                <div class="mb-3">
                    <h5>Monitoring Activities</h5>
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Observer</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${report.content.data.slice(0, 10).map(monitoring => `
                                <tr>
                                    <td>${formatMonitoringType(monitoring.type)}</td>
                                    <td>${formatDate(monitoring.date)}</td>
                                    <td>${monitoring.location}</td>
                                    <td>${monitoring.observer}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    ${report.content.data.length > 10 ? `<p>... and ${report.content.data.length - 10} more records</p>` : ''}
                </div>
                ` : ''}
                
                <div class="mb-3">
                    <h6>Record Created</h6>
                    <p>${formatDateTime(report.createdAt)}</p>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('viewReportModal'));
            modal.show();
        }

        // Complete activity
        function completeActivity(activityId) {
            const activity = db.activities.find(a => a.id == activityId);
            if (activity) {
                activity.status = 'completed';
                activity.endDate = new Date().toISOString();
                saveData();
                
                // Close the modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('viewActivityModal'));
                modal.hide();
                
                // Show success message
                showToast('Success', 'Activity marked as completed!');
                
                // Reload activities
                loadActivities();
            }
        }

        // Export to PDF
        function exportToPDF() {
            const modal = document.querySelector('.modal.show');
            if (!modal) return;
            
            const modalContent = modal.querySelector('.modal-body');
            
            html2canvas(modalContent).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF();
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save('export.pdf');
                
                showToast('Success', 'PDF exported successfully!');
            });
        }

        // Validate components selection
        function validateComponents() {
            const selectedComponents = Array.from(document.querySelectorAll('input[name="components"]:checked')).map(cb => cb.value);
            if (selectedComponents.length === 0) {
                document.getElementById('componentsFeedback').style.display = 'block';
            } else {
                document.getElementById('componentsFeedback').style.display = 'none';
            }
        }

        // Helper function to capitalize first letter
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Helper function to format date
        function formatDate(dateString) {
            if (!dateString) return 'Not specified';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Helper function to format date and time
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'Not specified';
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateTimeString).toLocaleDateString(undefined, options);
        }

        // Helper function to format activity type
        function formatActivityType(type) {
            switch(type) {
                case 'weed-control': return 'Weed Control';
                case 'revegetation': return 'Revegetation';
                case 'erosion-control': return 'Erosion Control';
                case 'fauna-survey': return 'Fauna Survey';
                case 'vegetation-survey': return 'Vegetation Survey';
                case 'water-quality': return 'Water Quality';
                default: return capitalizeFirstLetter(type);
            }
        }

        // Helper function to format monitoring type
        function formatMonitoringType(type) {
            switch(type) {
                case 'fauna-survey': return 'Fauna Survey';
                case 'vegetation-survey': return 'Vegetation Survey';
                case 'water-quality': return 'Water Quality Testing';
                case 'weed-mapping': return 'Weed Mapping';
                case 'erosion-monitoring': return 'Erosion Monitoring';
                default: return capitalizeFirstLetter(type);
            }
        }

        // Helper function to format report type
        function formatReportType(type) {
            switch(type) {
                case 'compliance': return 'Compliance Report';
                case 'maintenance': return 'Maintenance Summary';
                case 'monitoring': return 'Monitoring Summary';
                case 'health-trend': return 'Ecosystem Health Trend';
                case 'threat-management': return 'Threat Management';
                default: return capitalizeFirstLetter(type);
            }
        }

        // Helper function to get status badge class
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'completed': return 'bg-success';
                case 'in-progress': return 'bg-info';
                case 'planned': return 'bg-primary';
                case 'cancelled': return 'bg-secondary';
                default: return 'bg-light text-dark';
            }
        }

        // Helper function to get health badge class
        function getHealthBadgeClass(health) {
            switch(health) {
                case 'excellent': return 'bg-success';
                case 'good': return 'bg-success';
                case 'fair': return 'bg-warning';
                case 'poor': return 'bg-danger';
                case 'degraded': return 'bg-danger';
                default: return 'bg-light text-dark';
            }
        }

        // Helper function to get species status badge class
        function getSpeciesStatusBadgeClass(status) {
            switch(status) {
                case 'native': return 'bg-success';
                case 'introduced': return 'bg-secondary';
                case 'weed': return 'bg-danger';
                case 'pest': return 'bg-danger';
                case 'endangered': return 'bg-danger';
                case 'vulnerable': return 'bg-warning';
                case 'threatened': return 'bg-warning';
                default: return 'bg-light text-dark';
            }
        }
    </script>
</body>
</html>
